{% extends 'board_base.html' %}
{% load i18n %}
{% load mptt_tags %}
{% load forum_tags %}
{% load forum_conversation_tags %}
{% load forum_permission_tags %}
{% load forum_tracking_tags %}

{% block sub_title %}{{ forum.name }}{% endblock sub_title %}

{% block content %}
    <div class="row">
        <div class="col-12">
            <h1 class="mb-0">{{ forum.name }}</h1>
            <small class="text-muted">{{forum.description}}</small>
        </div>
    </div>
    {% if sub_forums %}
        <div class="row justify-content-end">
            <div class="col-12 col-sm-auto">
                {% if request.user.is_authenticated %}
                    <a href="{% url 'forum_tracking:mark_subforums_read' forum.pk %}" class="btn btn-sm btn-block btn-ico btn-link pr-0">
                        <i class="ri-checkbox-circle-line ri-lg"></i>
                        <span>{% trans "Mark subforums read" %}</span>
                    </a>
                {% endif %}
            </div>
        </div>
        {% forum_list sub_forums %}
    {% endif %}
    {% if forum.is_forum %}
        <div class="mt-4 row justify-content-between">
            {% get_permission 'can_add_topic' forum request.user as user_can_add_topic %}
            {% if user_can_add_topic %}
                <div class="col-12 col-sm-auto forum-actions-block">
                    <a href="{% url 'forum_conversation:topic_create' forum.slug forum.pk %}" class="btn btn-primary btn-sm btn-ico btn-block">
                        <i class="ri-chat-new-line ri-lg"></i>
                        <span>{% trans "New topic" %}</span>
                    </a>
                </div>
            {% endif %}

        </div>
        {% trans "Announcements" as announcements_title_trans %}
        {% with topic_list_title=announcements_title_trans topics=announces hide_if_empty=True unread_topics=unread_topics %}
            {% include "forum_conversation/topic_list.html" %} <!-- note vincentporte : to be optimized -->
        {% endwith %}
        {% trans "Topics" as topics_title_trans %}
        {% with topic_list_title=topics_title_trans unread_topics=unread_topics%}
            {% include "forum_conversation/topic_list.html" %} <!-- note vincentporte : to be optimized -->
        {% endwith %}
        <div class="mt-5 mb-5 row">
            <div class="col-12">
                {% with "justify-content-center" as pagination_size %}
                    {% include "partials/pagination.html" %}
                {% endwith %}
            </div>
        </div>
    {% endif %}

    {% get_permission 'can_approve_posts' forum request.user as user_can_invite_to_forum %}
    {% if user_can_invite_to_forum %}
        <hr>
        <p class="fs-lg">Inviter des nouveaux membres en partageant ce lien : <br><strong>{{ request.scheme }}://{{ request.META.HTTP_HOST }}{% url 'members:join_forum_form' forum.invitation_token %}</strong></p>
    {%endif%}

{% endblock content %}
